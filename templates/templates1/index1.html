{% extends 'base1.html' %}

{% block title %}–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤{% endblock %}

{% block content %}
<h2>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>

<div class="controls">
    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –° –í–´–ë–û–†–û–ú –ü–û–õ–Ø -->
    <div class="search-box">
        <form method="get" action="{{ url_for('hr.index') }}">
            <div class="search-container">
                <select name="search_field" class="search-select">
                    <option value="all" {% if search_field == 'all' %}selected{% endif %}>–í—Å–µ –ø–æ–ª—è</option>
                    <option value="full_name" {% if search_field == 'full_name' %}selected{% endif %}>–§–ò–û</option>
                    <option value="position" {% if search_field == 'position' %}selected{% endif %}>–î–æ–ª–∂–Ω–æ—Å—Ç—å</option>
                    <option value="gender" {% if search_field == 'gender' %}selected{% endif %}>–ü–æ–ª</option>
                    <option value="phone" {% if search_field == 'phone' %}selected{% endif %}>–¢–µ–ª–µ—Ñ–æ–Ω</option>
                    <option value="email" {% if search_field == 'email' %}selected{% endif %}>Email</option>
                    <option value="probation" {% if search_field == 'probation' %}selected{% endif %}>–ò—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫</option>
                    <option value="hire_date" {% if search_field == 'hire_date' %}selected{% endif %}>–î–∞—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option>
                </select>
                
                <input type="text" name="search" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞..." 
                       value="{{ search }}" class="search-input">
                
                <input type="hidden" name="sort" value="{{ sort }}">
                <input type="hidden" name="direction" value="{{ direction }}">
                
                <button type="submit" class="btn">–ù–∞–π—Ç–∏</button>
                
                {% if search %}
                    <a href="{{ url_for('hr.index', sort=sort, direction=direction) }}" 
                       class="btn-cancel">–°–±—Ä–æ—Å–∏—Ç—å</a>
                {% endif %}
            </div>
            
            {% if search %}
                <div class="search-info">
                    –ü–æ–∏—Å–∫: <strong>{{ search }}</strong> –≤ –ø–æ–ª–µ: 
                    <strong>
                        {% if search_field == 'all' %}–í—Å–µ –ø–æ–ª—è
                        {% elif search_field == 'full_name' %}–§–ò–û
                        {% elif search_field == 'position' %}–î–æ–ª–∂–Ω–æ—Å—Ç—å
                        {% elif search_field == 'gender' %}–ü–æ–ª
                        {% elif search_field == 'phone' %}–¢–µ–ª–µ—Ñ–æ–Ω
                        {% elif search_field == 'email' %}Email
                        {% elif search_field == 'probation' %}–ò—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫
                        {% elif search_field == 'hire_date' %}–î–∞—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                        {% endif %}
                    </strong>
                </div>
            {% endif %}
        </form>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="info-box">
        <p>–ù–∞–π–¥–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: <strong>{{ total_count }}</strong></p>
        <p>–ü–æ–∫–∞–∑–∞–Ω–æ: <strong>{{ employees|length }}</strong> –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ {{ page }}</p>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
<table>
    <thead>
        <tr>
            <th>
                <a href="{{ url_for('hr.index', sort='id', direction='desc' if sort == 'id' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    ID {% if sort == 'id' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='full_name', direction='desc' if sort == 'full_name' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    –§–ò–û {% if sort == 'full_name' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='position', direction='desc' if sort == 'position' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    –î–æ–ª–∂–Ω–æ—Å—Ç—å {% if sort == 'position' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='gender', direction='desc' if sort == 'gender' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    –ü–æ–ª {% if sort == 'gender' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='phone', direction='desc' if sort == 'phone' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    –¢–µ–ª–µ—Ñ–æ–Ω {% if sort == 'phone' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='email', direction='desc' if sort == 'email' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    Email {% if sort == 'email' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='probation', direction='desc' if sort == 'probation' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    –ò—Å–ø—ã—Ç. —Å—Ä–æ–∫ {% if sort == 'probation' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            <th>
                <a href="{{ url_for('hr.index', sort='hire_date', direction='desc' if sort == 'hire_date' and direction == 'asc' else 'asc', search=search, search_field=search_field) }}">
                    –î–∞—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {% if sort == 'hire_date' %}{{ '‚ñº' if direction == 'desc' else '‚ñ≤' }}{% endif %}
                </a>
            </th>
            {% if session.get('user_id') %}
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for emp in employees %}
        <tr>
            <td>{{ emp.id }}</td>
            <td>{{ emp.full_name }}</td>
            <td>{{ emp.position }}</td>
            <td>{{ emp.gender }}</td>
            <td>{{ emp.phone }}</td>
            <td>{{ emp.email }}</td>
            <td>{{ '–î–∞' if emp.probation else '–ù–µ—Ç' }}</td>
            <td>{{ emp.hire_date.strftime('%Y-%m-%d') if emp.hire_date else '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</td>
            {% if session.get('user_id') %}
            <td class="actions">
                <a href="{{ url_for('hr.edit_employee', id=emp.id) }}" class="btn-small">‚úèÔ∏è</a>
                <a href="{{ url_for('hr.delete_employee', id=emp.id) }}" class="btn-small btn-danger">üóëÔ∏è</a>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
<div class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('hr.index', page=page-1, search=search, search_field=search_field, sort=sort, direction=direction) }}" 
           class="btn-cancel">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}
    
    {% if has_more %}
        <a href="{{ url_for('hr.index', page=page+1, search=search, search_field=search_field, sort=sort, direction=direction) }}" 
           class="btn">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ 20 ‚Üí</a>
    {% endif %}
</div>

<!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
<div class="action-buttons">
    {% if session.get('user_id') %}
        <a href="{{ url_for('hr.add_employee') }}" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
        <a href="{{ url_for('hr.generate_test_data') }}" class="btn-cancel" 
           onclick="return confirm('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 150 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤? –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')">
           üß™ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        </a>
    {% endif %}
</div>
{% endblock %}